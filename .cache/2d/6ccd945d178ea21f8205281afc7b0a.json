{"id":"oSpf","dependencies":[{"name":"D:\\Projects\\ol\\package.json","includedInParent":true,"mtime":1586548571472},{"name":"D:\\Projects\\ol\\node_modules\\ol\\package.json","includedInParent":true,"mtime":1586157047249},{"name":"../../util.js","loc":{"line":17,"column":23},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\util.js"},{"name":"../../TileState.js","loc":{"line":18,"column":22},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\TileState.js"},{"name":"../../ViewHint.js","loc":{"line":19,"column":21},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\ViewHint.js"},{"name":"../../events.js","loc":{"line":20,"column":38},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\events.js"},{"name":"../../events/EventType.js","loc":{"line":21,"column":22},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\events\\EventType.js"},{"name":"../../extent.js","loc":{"line":22,"column":108},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\extent.js"},{"name":"../../layer/VectorTileRenderType.js","loc":{"line":23,"column":33},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\layer\\VectorTileRenderType.js"},{"name":"../../render/canvas/BuilderType.js","loc":{"line":24,"column":23},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\render\\canvas\\BuilderType.js"},{"name":"../../render/canvas/BuilderGroup.js","loc":{"line":25,"column":31},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\render\\canvas\\BuilderGroup.js"},{"name":"./TileLayer.js","loc":{"line":26,"column":36},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\TileLayer.js"},{"name":"../../size.js","loc":{"line":27,"column":23},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\size.js"},{"name":"../vector.js","loc":{"line":28,"column":80},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\vector.js"},{"name":"../../transform.js","loc":{"line":29,"column":167},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\transform.js"},{"name":"../../render/canvas/ExecutorGroup.js","loc":{"line":30,"column":53},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\render\\canvas\\ExecutorGroup.js"},{"name":"../../obj.js","loc":{"line":31,"column":22},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\obj.js"},{"name":"../../render/canvas/hitdetect.js","loc":{"line":32,"column":55},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\render\\canvas\\hitdetect.js"},{"name":"../../coordinate.js","loc":{"line":33,"column":22},"parent":"D:\\Projects\\ol\\node_modules\\ol\\renderer\\canvas\\VectorTileLayer.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\coordinate.js"}],"generated":{"js":"var $oSpf$exports={};$parcel$require(\"oSpf\",\"../../util.js\"),$parcel$require(\"oSpf\",\"../../TileState.js\"),$parcel$require(\"oSpf\",\"../../ViewHint.js\"),$parcel$require(\"oSpf\",\"../../events.js\"),$parcel$require(\"oSpf\",\"../../events/EventType.js\"),$parcel$require(\"oSpf\",\"../../extent.js\"),$parcel$require(\"oSpf\",\"../../layer/VectorTileRenderType.js\"),$parcel$require(\"oSpf\",\"../../render/canvas/BuilderType.js\"),$parcel$require(\"oSpf\",\"../../render/canvas/BuilderGroup.js\"),$parcel$require(\"oSpf\",\"./TileLayer.js\"),$parcel$require(\"oSpf\",\"../../size.js\"),$parcel$require(\"oSpf\",\"../vector.js\"),$parcel$require(\"oSpf\",\"../../transform.js\"),$parcel$require(\"oSpf\",\"../../render/canvas/ExecutorGroup.js\"),$parcel$require(\"oSpf\",\"../../obj.js\"),$parcel$require(\"oSpf\",\"../../render/canvas/hitdetect.js\"),$parcel$require(\"oSpf\",\"../../coordinate.js\");var $oSpf$var$__extends=$oSpf$exports&&$oSpf$exports.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),$oSpf$var$IMAGE_REPLAYS={image:[$oSpf$import$ReplayType.POLYGON,$oSpf$import$ReplayType.CIRCLE,$oSpf$import$ReplayType.LINE_STRING,$oSpf$import$ReplayType.IMAGE,$oSpf$import$ReplayType.TEXT],hybrid:[$oSpf$import$ReplayType.POLYGON,$oSpf$import$ReplayType.LINE_STRING],vector:[]},$oSpf$var$VECTOR_REPLAYS={image:[$oSpf$import$ReplayType.DEFAULT],hybrid:[$oSpf$import$ReplayType.IMAGE,$oSpf$import$ReplayType.TEXT,$oSpf$import$ReplayType.DEFAULT],vector:[$oSpf$import$ReplayType.POLYGON,$oSpf$import$ReplayType.CIRCLE,$oSpf$import$ReplayType.LINE_STRING,$oSpf$import$ReplayType.IMAGE,$oSpf$import$ReplayType.TEXT,$oSpf$import$ReplayType.DEFAULT]},$oSpf$export$default=function(e){function t(t){var r=e.call(this,t)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.dirty_=!1,r.renderedLayerRevision_,r.renderedPixelToCoordinateTransform_=null,r.renderedRotation_,r.renderTileImageQueue_={},r.tileListenerKeys_={},r.tmpTransform_=$oSpf$import$createTransform(),r}return $oSpf$var$__extends(t,e),t.prototype.prepareTile=function(e,t,r,o){var i,n=$oSpf$import$getUid(e),p=e.getState();return(p===$oSpf$import$TileState.LOADED&&e.hifi||p===$oSpf$import$TileState.ERROR)&&n in this.tileListenerKeys_&&($oSpf$import$unlistenByKey(this.tileListenerKeys_[n]),delete this.tileListenerKeys_[n]),p!==$oSpf$import$TileState.LOADED&&p!==$oSpf$import$TileState.ERROR||(this.updateExecutorGroup_(e,t,r),this.tileImageNeedsRender_(e,t,r)&&(i=!0,o&&(this.renderTileImageQueue_[n]=e))),i},t.prototype.getTile=function(t,r,o,i){var n=i.pixelRatio,p=i.viewState,a=p.resolution,$=p.projection,l=this.getLayer(),s=l.getSource().getTile(t,r,o,n,$);if(s.getState()<$oSpf$import$TileState.LOADED){s.wantedResolution=a;var d=$oSpf$import$getUid(s);if(!(d in this.tileListenerKeys_)){var f=$oSpf$import$listen(s,$oSpf$import$EventType.CHANGE,this.prepareTile.bind(this,s,n,$,!0));this.tileListenerKeys_[d]=f}}else{var u=i.viewHints;!!(u[$oSpf$import$ViewHint.ANIMATING]||u[$oSpf$import$ViewHint.INTERACTING])&&s.wantedResolution||(s.wantedResolution=a),this.prepareTile(s,n,$,!1)&&l.getRenderMode()!==$oSpf$import$VectorTileRenderType.VECTOR&&this.renderTileImage_(s,i)}return e.prototype.getTile.call(this,t,r,o,i)},t.prototype.isDrawableTile=function(t){var r=this.getLayer();return e.prototype.isDrawableTile.call(this,t)&&r.getRenderMode()===$oSpf$import$VectorTileRenderType.VECTOR||t.hasContext(r)},t.prototype.getTileImage=function(e){return e.getImage(this.getLayer())},t.prototype.prepareFrame=function(t){var r=this.getLayer().getRevision();return this.renderedLayerRevision_!=r&&(this.renderedTiles.length=0),this.renderedLayerRevision_=r,e.prototype.prepareFrame.call(this,t)},t.prototype.updateExecutorGroup_=function(e,t,r){var o=this.getLayer(),i=o.getRevision(),n=o.getRenderOrder()||null,p=e.wantedResolution,a=e.getReplayState(o);if(a.dirty||a.renderedResolution!==p||a.renderedRevision!=i||a.renderedRenderOrder!=n||a.renderedZ!==e.sourceZ){var $=o.getSource(),l=$.getTileGrid(),s=$.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),d=$.getSourceTiles(t,r,e),f=$oSpf$import$getUid(o);delete e.hitDetectionImageData[f],e.executorGroups[f]=[];for(var u=function(r,i){var u=d[r];if(u.getState()!=$oSpf$import$TileState.LOADED)return\"continue\";var S=u.tileCoord,c=l.getTileCoordExtent(S),g=$oSpf$import$getIntersection(s,c),m=$oSpf$import$equals(c,g)?null:$oSpf$import$buffer(g,o.getRenderBuffer()*p,T.tmpExtent);a.dirty=!1;var y=new $oSpf$import$CanvasBuilderGroup(0,g,p,t,o.getDeclutter()),h=$oSpf$import$getSquaredRenderTolerance(p,t),v=function(e){var t,r=e.getStyleFunction()||o.getStyleFunction();if(r&&(t=r(e,p)),t){var i=this.renderFeature(e,h,t,y);this.dirty_=this.dirty_||i,a.dirty=a.dirty||i}},R=u.getFeatures();n&&n!==a.renderedRenderOrder&&R.sort(n);for(var _=0,E=R.length;_<E;++_){var C=R[_];m&&!$oSpf$import$intersects(m,C.getGeometry().getExtent())||v.call(T,C)}var I=y.finish(),x=o.getRenderMode()!==$oSpf$import$VectorTileRenderType.VECTOR&&o.getDeclutter()&&1===d.length?null:g,L=new $oSpf$import$CanvasExecutorGroup(x,p,t,$.getOverlaps(),I,o.getRenderBuffer());e.executorGroups[f].push(L)},T=this,S=0,c=d.length;S<c;++S)u(S);a.renderedRevision=i,a.renderedZ=e.sourceZ,a.renderedRenderOrder=n,a.renderedResolution=p}},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,o,i){var n=t.viewState.resolution,p=t.viewState.rotation;r=null==r?0:r;var a,$,l,s=this.getLayer(),d=s.getDeclutter(),f=s.getSource().getTileGridForProjection(t.viewState.projection),u={},T=this.renderedTiles,S=function(){var t=T[$],l=f.getTileCoordExtent(t.wrappedTileCoord),S=$oSpf$import$containsCoordinate(l,e);if(!d&&!S)return\"continue\";for(var c=t.executorGroups[$oSpf$import$getUid(s)],g=0,m=c.length;g<m;++g){var y=c[g];a=a||y.forEachFeatureAtCoordinate(e,n,p,r,function(e){if(S||i&&-1!==i.indexOf(e)){var t=e.getId();if(void 0===t&&(t=$oSpf$import$getUid(e)),!(t in u))return u[t]=!0,o(e,s)}},s.getDeclutter()?i:null)}};for($=0,l=T.length;$<l;++$)S();return a},t.prototype.getFeatures=function(e){return new Promise(function(t,r){for(var o,i=this.getLayer(),n=$oSpf$import$getUid(i),p=i.getSource(),a=this.renderedProjection,$=a.getExtent(),l=this.renderedResolution,s=p.getTileGridForProjection(a),d=$oSpf$import$applyTransform(this.renderedPixelToCoordinateTransform_,e.slice()),f=s.getTileCoordForCoordAndResolution(d,l),u=0,T=this.renderedTiles.length;u<T;++u)if(f.toString()===this.renderedTiles[u].tileCoord.toString()){if((o=this.renderedTiles[u]).getState()===$oSpf$import$TileState.LOADED&&o.hifi){var S=s.getTileCoordExtent(o.tileCoord);p.getWrapX()&&a.canWrapX()&&!$oSpf$import$containsExtent($,S)&&$oSpf$import$wrapX(d,a);break}o=void 0}if(!o||o.loadingSourceTiles>0)t([]);else{var c=s.getTileCoordExtent(o.wrappedTileCoord),g=$oSpf$import$getTopLeft(c),m=[(d[0]-g[0])/l,(g[1]-d[1])/l],y=o.getSourceTiles().reduce(function(e,t){return e.concat(t.getFeatures())},[]),h=o.hitDetectionImageData[n];if(!h&&!this.animatingOrInteracting_){var v=$oSpf$import$toSize(s.getTileSize(s.getZForResolution(l))),R=[v[0]/2,v[1]/2],_=this.renderedRotation_,E=[this.getRenderTransform(s.getTileCoordCenter(o.wrappedTileCoord),l,0,.5,R[0],R[1],0)];h=$oSpf$import$createHitDetectionImageData(v,E,y,i.getStyleFunction(),s.getTileCoordExtent(o.wrappedTileCoord),o.getReplayState(i).renderedResolution,_),o.hitDetectionImageData[n]=h}t($oSpf$import$hitDetect(m,y,h))}}.bind(this))},t.prototype.handleFontsChanged=function(){$oSpf$import$clear(this.renderTileImageQueue_);var e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()},t.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()},t.prototype.renderFrame=function(t,r){var o=t.viewHints,i=!(o[$oSpf$import$ViewHint.ANIMATING]||o[$oSpf$import$ViewHint.INTERACTING]);this.renderQueuedTileImages_(i,t),e.prototype.renderFrame.call(this,t,r),this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;var n=this.getLayer(),p=n.getRenderMode();if(p===$oSpf$import$VectorTileRenderType.IMAGE)return this.container;var a=n.getSource(),$=t.usedTiles[$oSpf$import$getUid(a)];for(var l in this.renderTileImageQueue_)$&&l in $||delete this.renderTileImageQueue_[l];for(var s=this.context,d=n.getDeclutter()?{}:null,f=$oSpf$var$VECTOR_REPLAYS[p],u=t.pixelRatio,T=t.viewState,S=T.center,c=T.resolution,g=T.rotation,m=t.size,y=Math.round(m[0]*u),h=Math.round(m[1]*u),v=this.renderedTiles,R=a.getTileGridForProjection(t.viewState.projection),_=[],E=[],C=v.length-1;C>=0;--C)for(var I=v[C],x=I.tileCoord,L=R.getTileCoordExtent(I.wrappedTileCoord),w=R.getTileCoordExtent(x,this.tmpExtent)[0]-L[0],G=$oSpf$import$multiply($oSpf$import$scale(this.inversePixelTransform.slice(),1/u,1/u),this.getRenderTransform(S,c,g,u,y,h,w)),A=I.executorGroups[$oSpf$import$getUid(n)],D=!1,j=0,O=A.length;j<O;++j){var F=A[j];if(F.hasExecutors(f)){var P=I.tileCoord[0],N=void 0;if(!d&&!D){N=F.getClipCoords(G),s.save();for(var b=0,q=_.length;b<q;++b){var V=_[b];P<E[b]&&(s.beginPath(),s.moveTo(N[0],N[1]),s.lineTo(N[2],N[3]),s.lineTo(N[4],N[5]),s.lineTo(N[6],N[7]),s.moveTo(V[6],V[7]),s.lineTo(V[4],V[5]),s.lineTo(V[2],V[3]),s.lineTo(V[0],V[1]),s.clip())}}F.execute(s,G,g,i,f,d),d||D||(s.restore(),_.push(N),E.push(P),D=!0)}}if(d){var M=t.layerStatesArray[t.layerIndex];$oSpf$import$replayDeclutter(d,s,g,M.opacity,i,t.declutterItems)}return this.container},t.prototype.renderQueuedTileImages_=function(e,t){for(var r in this.renderTileImageQueue_){if(!e&&Date.now()-t.time>8){t.animate=!0;break}var o=this.renderTileImageQueue_[r];delete this.renderTileImageQueue_[r],this.renderTileImage_(o,t)}},t.prototype.renderFeature=function(e,t,r,o){if(!r)return!1;var i=!1;if(Array.isArray(r))for(var n=0,p=r.length;n<p;++n)i=$oSpf$import$renderFeature(o,e,r[n],t,this.boundHandleStyleImageChange_)||i;else i=$oSpf$import$renderFeature(o,e,r,t,this.boundHandleStyleImageChange_);return i},t.prototype.tileImageNeedsRender_=function(e,t,r){var o=this.getLayer(),i=e.getReplayState(o),n=o.getRevision(),p=e.sourceZ,a=e.wantedResolution;return i.renderedTileResolution!==a||i.renderedTileRevision!==n||i.renderedTileZ!==p},t.prototype.renderTileImage_=function(e,t){var r=this.getLayer(),o=e.getReplayState(r),i=r.getRevision(),n=e.executorGroups[$oSpf$import$getUid(r)];o.renderedTileRevision=i,o.renderedTileZ=e.sourceZ;var p=e.wrappedTileCoord,a=p[0],$=r.getSource(),l=t.pixelRatio,s=t.viewState.projection,d=$.getTileGridForProjection(s),f=d.getResolution(e.tileCoord[0]),u=t.pixelRatio/e.wantedResolution*f,T=d.getResolution(a),S=e.getContext(r);l=Math.max(l,u/l);var c=$.getTilePixelSize(a,l,s);S.canvas.width=c[0],S.canvas.height=c[1];var g=l/u;if(1!==g){var m=$oSpf$import$resetTransform(this.tmpTransform_);$oSpf$import$scaleTransform(m,g,g),S.setTransform.apply(S,m)}var y=d.getTileCoordExtent(p,this.tmpExtent),h=u/T,v=$oSpf$import$resetTransform(this.tmpTransform_);$oSpf$import$scaleTransform(v,h,-h),$oSpf$import$translateTransform(v,-y[0],-y[3]);for(var R=0,_=n.length;R<_;++R){n[R].execute(S,v,0,!0,$oSpf$var$IMAGE_REPLAYS[r.getRenderMode()])}o.renderedTileResolution=e.wantedResolution},t}($oSpf$import$CanvasTileLayerRenderer);$oSpf$exports.default=$oSpf$export$default;"},"sourceMaps":null,"error":null,"hash":"365a520893795f98f595d8588a1fbdf7","cacheData":{"env":{},"imports":{"$oSpf$import$getUid":["../../util.js","getUid"],"$oSpf$import$TileState":["../../TileState.js","default"],"$oSpf$import$ViewHint":["../../ViewHint.js","default"],"$oSpf$import$listen":["../../events.js","listen"],"$oSpf$import$unlistenByKey":["../../events.js","unlistenByKey"],"$oSpf$import$EventType":["../../events/EventType.js","default"],"$oSpf$import$buffer":["../../extent.js","buffer"],"$oSpf$import$containsCoordinate":["../../extent.js","containsCoordinate"],"$oSpf$import$equals":["../../extent.js","equals"],"$oSpf$import$getIntersection":["../../extent.js","getIntersection"],"$oSpf$import$intersects":["../../extent.js","intersects"],"$oSpf$import$containsExtent":["../../extent.js","containsExtent"],"$oSpf$import$getTopLeft":["../../extent.js","getTopLeft"],"$oSpf$import$VectorTileRenderType":["../../layer/VectorTileRenderType.js","default"],"$oSpf$import$ReplayType":["../../render/canvas/BuilderType.js","default"],"$oSpf$import$CanvasBuilderGroup":["../../render/canvas/BuilderGroup.js","default"],"$oSpf$import$CanvasTileLayerRenderer":["./TileLayer.js","default"],"$oSpf$import$toSize":["../../size.js","toSize"],"$oSpf$import$getSquaredRenderTolerance":["../vector.js","getSquaredTolerance"],"$oSpf$import$renderFeature":["../vector.js","renderFeature"],"$oSpf$import$applyTransform":["../../transform.js","apply"],"$oSpf$import$createTransform":["../../transform.js","create"],"$oSpf$import$resetTransform":["../../transform.js","reset"],"$oSpf$import$scaleTransform":["../../transform.js","scale"],"$oSpf$import$translateTransform":["../../transform.js","translate"],"$oSpf$import$multiply":["../../transform.js","multiply"],"$oSpf$import$scale":["../../transform.js","scale"],"$oSpf$import$CanvasExecutorGroup":["../../render/canvas/ExecutorGroup.js","default"],"$oSpf$import$replayDeclutter":["../../render/canvas/ExecutorGroup.js","replayDeclutter"],"$oSpf$import$clear":["../../obj.js","clear"],"$oSpf$import$createHitDetectionImageData":["../../render/canvas/hitdetect.js","createHitDetectionImageData"],"$oSpf$import$hitDetect":["../../render/canvas/hitdetect.js","hitDetect"],"$oSpf$import$wrapX":["../../coordinate.js","wrapX"]},"exports":{"default":"$oSpf$export$default"},"wildcards":[],"sideEffects":false,"isCommonJS":true,"isES6Module":true}}