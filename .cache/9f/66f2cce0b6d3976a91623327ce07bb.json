{"id":"jMDC","dependencies":[{"name":"D:\\Projects\\ol\\package.json","includedInParent":true,"mtime":1586548571472},{"name":"D:\\Projects\\ol\\node_modules\\ol\\package.json","includedInParent":true,"mtime":1586157047249},{"name":"../util.js","loc":{"line":17,"column":23},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\util.js"},{"name":"../CollectionEventType.js","loc":{"line":18,"column":32},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\CollectionEventType.js"},{"name":"../coordinate.js","loc":{"line":19,"column":154},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\coordinate.js"},{"name":"../events.js","loc":{"line":20,"column":38},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\events.js"},{"name":"../events/EventType.js","loc":{"line":21,"column":22},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\events\\EventType.js"},{"name":"../extent.js","loc":{"line":22,"column":44},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\extent.js"},{"name":"../functions.js","loc":{"line":23,"column":28},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\functions.js"},{"name":"../geom/GeometryType.js","loc":{"line":24,"column":25},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\geom\\GeometryType.js"},{"name":"../geom/Polygon.js","loc":{"line":25,"column":27},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\geom\\Polygon.js"},{"name":"./Pointer.js","loc":{"line":26,"column":31},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Pointer.js"},{"name":"../obj.js","loc":{"line":27,"column":26},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\obj.js"},{"name":"../source/VectorEventType.js","loc":{"line":28,"column":28},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\source\\VectorEventType.js"},{"name":"../structs/RBush.js","loc":{"line":29,"column":18},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\structs\\RBush.js"},{"name":"../proj.js","loc":{"line":30,"column":72},"parent":"D:\\Projects\\ol\\node_modules\\ol\\interaction\\Snap.js","resolved":"D:\\Projects\\ol\\node_modules\\ol\\proj.js"}],"generated":{"js":"var $jMDC$exports={};$parcel$require(\"jMDC\",\"../util.js\"),$parcel$require(\"jMDC\",\"../CollectionEventType.js\"),$parcel$require(\"jMDC\",\"../coordinate.js\"),$parcel$require(\"jMDC\",\"../events.js\"),$parcel$require(\"jMDC\",\"../events/EventType.js\"),$parcel$require(\"jMDC\",\"../extent.js\"),$parcel$require(\"jMDC\",\"../functions.js\"),$parcel$require(\"jMDC\",\"../geom/GeometryType.js\"),$parcel$require(\"jMDC\",\"../geom/Polygon.js\"),$parcel$require(\"jMDC\",\"./Pointer.js\"),$parcel$require(\"jMDC\",\"../obj.js\"),$parcel$require(\"jMDC\",\"../source/VectorEventType.js\"),$parcel$require(\"jMDC\",\"../structs/RBush.js\"),$parcel$require(\"jMDC\",\"../proj.js\");var $jMDC$var$__extends=$jMDC$exports&&$jMDC$exports.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();function $jMDC$var$getFeatureFromEvent(e){return e.feature?e.feature:e.element?e.element:void 0}var $jMDC$var$tempSegment=[],$jMDC$export$default=function(e){function t(t){var r=this,o=t||{},i=o;return i.handleDownEvent||(i.handleDownEvent=$jMDC$import$TRUE),i.stopDown||(i.stopDown=$jMDC$import$FALSE),(r=e.call(this,i)||this).source_=o.source?o.source:null,r.vertex_=void 0===o.vertex||o.vertex,r.edge_=void 0===o.edge||o.edge,r.features_=o.features?o.features:null,r.featuresListenerKeys_=[],r.featureChangeListenerKeys_={},r.indexedFeaturesExtents_={},r.pendingFeatures_={},r.pixelTolerance_=void 0!==o.pixelTolerance?o.pixelTolerance:10,r.rBush_=new $jMDC$import$RBush,r.SEGMENT_WRITERS_={Point:r.writePointGeometry_.bind(r),LineString:r.writeLineStringGeometry_.bind(r),LinearRing:r.writeLineStringGeometry_.bind(r),Polygon:r.writePolygonGeometry_.bind(r),MultiPoint:r.writeMultiPointGeometry_.bind(r),MultiLineString:r.writeMultiLineStringGeometry_.bind(r),MultiPolygon:r.writeMultiPolygonGeometry_.bind(r),GeometryCollection:r.writeGeometryCollectionGeometry_.bind(r),Circle:r.writeCircleGeometry_.bind(r)},r}return $jMDC$var$__extends(t,e),t.prototype.addFeature=function(e,t){var r=void 0===t||t,o=$jMDC$import$getUid(e),i=e.getGeometry();if(i){var n=this.SEGMENT_WRITERS_[i.getType()];n&&(this.indexedFeaturesExtents_[o]=i.getExtent($jMDC$import$createEmpty()),n(e,i))}r&&(this.featureChangeListenerKeys_[o]=$jMDC$import$listen(e,$jMDC$import$EventType.CHANGE,this.handleFeatureChange_,this))},t.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)},t.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)},t.prototype.getFeatures_=function(){var e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e},t.prototype.handleEvent=function(t){var r=this.snapTo(t.pixel,t.coordinate,t.map);return r.snapped&&(t.coordinate=r.vertex.slice(0,2),t.pixel=r.vertexPixel),e.prototype.handleEvent.call(this,t)},t.prototype.handleFeatureAdd_=function(e){var t=$jMDC$var$getFeatureFromEvent(e);this.addFeature(t)},t.prototype.handleFeatureRemove_=function(e){var t=$jMDC$var$getFeatureFromEvent(e);this.removeFeature(t)},t.prototype.handleFeatureChange_=function(e){var t=e.target;if(this.handlingDownUpSequence){var r=$jMDC$import$getUid(t);r in this.pendingFeatures_||(this.pendingFeatures_[r]=t)}else this.updateFeature_(t)},t.prototype.handleUpEvent=function(e){var t=$jMDC$import$getValues(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},t.prototype.removeFeature=function(e,t){var r=void 0===t||t,o=$jMDC$import$getUid(e),i=this.indexedFeaturesExtents_[o];if(i){var n=this.rBush_,a=[];n.forEachInExtent(i,function(t){e===t.feature&&a.push(t)});for(var s=a.length-1;s>=0;--s)n.remove(a[s])}r&&($jMDC$import$unlistenByKey(this.featureChangeListenerKeys_[o]),delete this.featureChangeListenerKeys_[o])},t.prototype.setMap=function(t){var r=this.getMap(),o=this.featuresListenerKeys_,i=this.getFeatures_();r&&(o.forEach($jMDC$import$unlistenByKey),o.length=0,i.forEach(this.forEachFeatureRemove_.bind(this))),e.prototype.setMap.call(this,t),t&&(this.features_?o.push($jMDC$import$listen(this.features_,$jMDC$import$CollectionEventType.ADD,this.handleFeatureAdd_,this),$jMDC$import$listen(this.features_,$jMDC$import$CollectionEventType.REMOVE,this.handleFeatureRemove_,this)):this.source_&&o.push($jMDC$import$listen(this.source_,$jMDC$import$VectorEventType.ADDFEATURE,this.handleFeatureAdd_,this),$jMDC$import$listen(this.source_,$jMDC$import$VectorEventType.REMOVEFEATURE,this.handleFeatureRemove_,this)),i.forEach(this.forEachFeatureAdd_.bind(this)))},t.prototype.snapTo=function(e,t,r){var o=r.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),i=r.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),n=$jMDC$import$boundingExtent([o,i]),a=this.rBush_.getInExtent(n);this.vertex_&&!this.edge_&&(a=a.filter(function(e){return e.feature.getGeometry().getType()!==$jMDC$import$GeometryType.CIRCLE}));var s=!1,$=null,p=null;if(0===a.length)return{snapped:s,vertex:$,vertexPixel:p};for(var u,l=r.getView().getProjection(),h=$jMDC$import$fromUserCoordinate(t,l),m=1/0,C=0;C<a.length;++C){var d=a[C];$jMDC$var$tempSegment[0]=$jMDC$import$fromUserCoordinate(d.segment[0],l),$jMDC$var$tempSegment[1]=$jMDC$import$fromUserCoordinate(d.segment[1],l);var c=$jMDC$import$squaredDistanceToSegment(h,$jMDC$var$tempSegment);c<m&&(u=d,m=c)}var g=u.segment;if(this.vertex_&&!this.edge_){var v=r.getPixelFromCoordinate(g[0]),f=r.getPixelFromCoordinate(g[1]),_=$jMDC$import$squaredCoordinateDistance(e,v),M=$jMDC$import$squaredCoordinateDistance(e,f);Math.sqrt(Math.min(_,M))<=this.pixelTolerance_&&(s=!0,$=_>M?g[1]:g[0],p=r.getPixelFromCoordinate($))}else if(this.edge_){var j=u.feature.getGeometry().getType()===$jMDC$import$GeometryType.CIRCLE;if(j){var D=u.feature.getGeometry(),y=$jMDC$import$getUserProjection();y&&(D=D.clone().transform(y,l)),$=$jMDC$import$toUserCoordinate($jMDC$import$closestOnCircle(h,D),l)}else $jMDC$var$tempSegment[0]=$jMDC$import$fromUserCoordinate(g[0],l),$jMDC$var$tempSegment[1]=$jMDC$import$fromUserCoordinate(g[1],l),$=$jMDC$import$toUserCoordinate($jMDC$import$closestOnSegment(h,$jMDC$var$tempSegment),l);if(p=r.getPixelFromCoordinate($),$jMDC$import$coordinateDistance(e,p)<=this.pixelTolerance_&&(s=!0,this.vertex_&&!j)){v=r.getPixelFromCoordinate(g[0]),f=r.getPixelFromCoordinate(g[1]),_=$jMDC$import$squaredCoordinateDistance(p,v),M=$jMDC$import$squaredCoordinateDistance(p,f);Math.sqrt(Math.min(_,M))<=this.pixelTolerance_&&($=_>M?g[1]:g[0],p=r.getPixelFromCoordinate($))}}return s&&(p=[Math.round(p[0]),Math.round(p[1])]),{snapped:s,vertex:$,vertexPixel:p}},t.prototype.updateFeature_=function(e){this.removeFeature(e,!1),this.addFeature(e,!1)},t.prototype.writeCircleGeometry_=function(e,t){var r=this.getMap().getView().getProjection(),o=t,i=$jMDC$import$getUserProjection();i&&(o=o.clone().transform(i,r));var n=$jMDC$import$fromCircle(o);i&&n.transform(r,i);for(var a=n.getCoordinates()[0],s=0,$=a.length-1;s<$;++s){var p=a.slice(s,s+2),u={feature:e,segment:p};this.rBush_.insert($jMDC$import$boundingExtent(p),u)}},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),o=0;o<r.length;++o){var i=this.SEGMENT_WRITERS_[r[o].getType()];i&&i(e,r[o])}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),o=0,i=r.length-1;o<i;++o){var n=r.slice(o,o+2),a={feature:e,segment:n};this.rBush_.insert($jMDC$import$boundingExtent(n),a)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),o=0,i=r.length;o<i;++o)for(var n=r[o],a=0,s=n.length-1;a<s;++a){var $=n.slice(a,a+2),p={feature:e,segment:$};this.rBush_.insert($jMDC$import$boundingExtent($),p)}},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),o=0,i=r.length;o<i;++o){var n=r[o],a={feature:e,segment:[n,n]};this.rBush_.insert(t.getExtent(),a)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),o=0,i=r.length;o<i;++o)for(var n=r[o],a=0,s=n.length;a<s;++a)for(var $=n[a],p=0,u=$.length-1;p<u;++p){var l=$.slice(p,p+2),h={feature:e,segment:l};this.rBush_.insert($jMDC$import$boundingExtent(l),h)}},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),o={feature:e,segment:[r,r]};this.rBush_.insert(t.getExtent(),o)},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),o=0,i=r.length;o<i;++o)for(var n=r[o],a=0,s=n.length-1;a<s;++a){var $=n.slice(a,a+2),p={feature:e,segment:$};this.rBush_.insert($jMDC$import$boundingExtent($),p)}},t}($jMDC$import$PointerInteraction);$jMDC$exports.default=$jMDC$export$default;"},"sourceMaps":null,"error":null,"hash":"e538382a65cd45ba017c941b14f3cdb4","cacheData":{"env":{},"imports":{"$jMDC$import$getUid":["../util.js","getUid"],"$jMDC$import$CollectionEventType":["../CollectionEventType.js","default"],"$jMDC$import$coordinateDistance":["../coordinate.js","distance"],"$jMDC$import$squaredCoordinateDistance":["../coordinate.js","squaredDistance"],"$jMDC$import$closestOnCircle":["../coordinate.js","closestOnCircle"],"$jMDC$import$closestOnSegment":["../coordinate.js","closestOnSegment"],"$jMDC$import$squaredDistanceToSegment":["../coordinate.js","squaredDistanceToSegment"],"$jMDC$import$listen":["../events.js","listen"],"$jMDC$import$unlistenByKey":["../events.js","unlistenByKey"],"$jMDC$import$EventType":["../events/EventType.js","default"],"$jMDC$import$boundingExtent":["../extent.js","boundingExtent"],"$jMDC$import$createEmpty":["../extent.js","createEmpty"],"$jMDC$import$TRUE":["../functions.js","TRUE"],"$jMDC$import$FALSE":["../functions.js","FALSE"],"$jMDC$import$GeometryType":["../geom/GeometryType.js","default"],"$jMDC$import$fromCircle":["../geom/Polygon.js","fromCircle"],"$jMDC$import$PointerInteraction":["./Pointer.js","default"],"$jMDC$import$getValues":["../obj.js","getValues"],"$jMDC$import$VectorEventType":["../source/VectorEventType.js","default"],"$jMDC$import$RBush":["../structs/RBush.js","default"],"$jMDC$import$getUserProjection":["../proj.js","getUserProjection"],"$jMDC$import$fromUserCoordinate":["../proj.js","fromUserCoordinate"],"$jMDC$import$toUserCoordinate":["../proj.js","toUserCoordinate"]},"exports":{"default":"$jMDC$export$default"},"wildcards":[],"sideEffects":false,"isCommonJS":true,"isES6Module":true}}